# FlowWrapper

Program flow: startup from no power, hangs in main loop checking for button presses. If start button pressed, run startup sequence and home all axis, wait 2s then run. Continuously keep checking for stop button presses. If stop button pressed, stop machine. If settings button pressed while stopped, set paper speed(untested, speed is hardcoded for this version). Continue checking for button presses.

This program sort of works. Homing is successful, startup is successful. Can run up to 160 patties through(usually closer to 140) before feeder chain goes nuts and randomly speeds up and gets out of time. It is accurate right up to the point it changes significantly. It is too consistent to be a mechanicla issues, unless it is something on the circuit side. Still too consistent........I have been leaning towards overflow of some sort but have been unable to nail it down. Encoder counts when problem arises are about 58,000 and 78,000 for the paper and feeder chain encoder counters, respectively. Hitting stop button, clearing the mis-aligned mints(getting good at this, max time to clear is about 30s, min time 5s) and then restarting will allow you to run for about another 140 patties before problem repeats. Only things done in code with a stop/start is the encoder counters are rest to 0, and all the pin change interrupts(inputs for jaw position, finger position, register mark detection) are disabled/reenabled; all axis are rehomed as part of the startup process, and all VFDs are disabled/reenabled. Did note that I neglected to reset the timingScalar when I added that in but the restart still runs successfully. 

timingScalar was added to compensate for accumulated error in the encoder counts. Prior to that could only run about 30 patties through before placement error was too great(accumulated error, probably due to either missing encoder counts or more likely the fact I am using a floating point scalar to align the paper and feeder drives).

Played with some code(shown in sketch, commented out) to subtract the encoder counters by 10,000 to keep them from getting super large but as soon as that hits the feeder chain does the same thing as when it reaches ~140 patties....... hmmmm.....
